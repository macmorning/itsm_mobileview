<html>
<head>
<!--	<link rel="stylesheet" href="lib\jquery.mobile-1.2.0.min.css" />
	<script src="lib\jquery.js"></script>
	<script src="lib\jquery.mobile-1.2.0.min.js"></script>-->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
	<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
	<script>
		function getUserID(credentials)
		{
			$.mobile.loading('show');
			var wsURL='/arsys/services/ARService?server=' + credentials.server + '&webService=User';
			var soapMessage ='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:HPD_IncidentInterface_WS">\
							   <soapenv:Header>\
								  <urn:AuthenticationInfo>\
									 <urn:userName>' + credentials.username + '</urn:userName>\
									 <urn:password>' + credentials.password + '</urn:password>\
								  </urn:AuthenticationInfo>\
							   </soapenv:Header>\
							   <soapenv:Body>\
								  <urn:OpGetList>\
									 <urn:Qualification>\'Login Name\'="' + credentials.username + '" AND \'Status\'=0</urn:Qualification>\
									 <urn:startRecord>0</urn:startRecord>\
									 <urn:maxLimit>1</urn:maxLimit>\
								  </urn:OpGetList>\
							   </soapenv:Body>\
							</soapenv:Envelope>';
			var jqxhr = $.ajax({
				url: wsURL,
				beforeSend: function( xhr ){
						// Pass the action onto the proxy.
						xhr.setRequestHeader(
						"SOAPAction",
						"POST"
						);
				},
				type: "POST",
				dataType: "xml",
				data: soapMessage,
				success: userSuccess,
				error: userError,
				contentType: "text/xml; charset=\"utf-8\""				
			});
			return false;
		}

		function userSuccess(request,status)
		{
			$.mobile.loading('hide');
			$(request).find("ns0\\:getListValues").each(function()
			{
				$("#homeName").html($(this).find("ns0\\:Full_Name").text());
			});
			$.mobile.changePage($("#homepage"));
		}

		function userError(request,status,error)
		{
			$.mobile.loading('hide');
			alert("Authentication error : " + + error);
		}

	
		function getIncidentsList(credentials)
		{
			$.mobile.loading('show');
			var wsURL='/arsys/services/ARService?server=' + credentials.server + '&webService=HPD_IncidentInterface_WS';
			var soapMessage ='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:HPD_IncidentInterface_WS">\
							   <soapenv:Header>\
								  <urn:AuthenticationInfo>\
									 <urn:userName>' + credentials.username + '</urn:userName>\
									 <urn:password>' + credentials.password + '</urn:password>\
								  </urn:AuthenticationInfo>\
							   </soapenv:Header>\
							   <soapenv:Body>\
								  <urn:HelpDesk_QueryList_Service>\
									 <urn:Qualification>\'Assignee Login ID\'="' + credentials.username + '" AND \'Status\'&lt;5</urn:Qualification>\
									 <urn:startRecord>0</urn:startRecord>\
									 <urn:maxLimit>50</urn:maxLimit>\
								  </urn:HelpDesk_QueryList_Service>\
							   </soapenv:Body>\
							</soapenv:Envelope>';
			var jqxhr = $.ajax({
				url: wsURL,
				beforeSend: function( xhr ){
						// Pass the action onto the proxy.
						xhr.setRequestHeader(
						"SOAPAction",
						"POST"
						);
				},
				type: "POST",
				dataType: "xml",
				data: soapMessage,
				success: callSuccess,
				error: callError,
				contentType: "text/xml; charset=\"utf-8\""				
			});
			return false;
		}
		
		function callSuccess(request,status)
		{
			$.mobile.loading('hide');
			$(request).find("ns0\\:getListValues").each(function()
			{
				$("#incidentslist").append('<li><a href="line1"><h1>'+$(this).find("ns0\\:Incident_Number").text()+'-'+$(this).find("ns0\\:Priority").text()+'</h1><p>'+$(this).find("ns0\\:Summary").text()+'</p></a></li>');
			});
			$.mobile.changePage($("#incidentspage"));
		}

		function callError(request,status,error)
		{
			$.mobile.loading('hide');
			alert("error : " + + error);
		}


		$(document).ready(function() {
			$("#login_submit").click(function(event) {
				event.preventDefault();
				var credentials = { server: $('#login_server').val(), username: $('#login_username').val(), password: $('#login_password').val() };
				getUserID(credentials);
				});
		});
	</script>
</head>
<body>

<div data-role="page" id="loginpage"> <!-- identification -->
	<header data-role="header">
		<h1>Login</h1>
	</header>
	<form method="POST" action="" data-ajax="false">
		<label for="login_server">Server:</label>
		<input type="text" name="login_server" id="login_server" value="ittux8"/>
		<label for="login_username">Username:</label>
		<input type="text" name="login_username" id="login_username" />
		<label for="login_password">Password:</label>
		<input type="password" name="login_password" id="login_password" />
		<button id="login_submit" type="submit" data-theme="a">Submit</button>
	</form>	
</div>

<div data-role="page" id="homepage"> <!-- Home Page -->
	<header data-role="header">
		<h1>ITSM Mobile Home</h1>
		<a href="#loginpage">Exit</a>
	</header>
	<p style="text-align:center;" id="homeName"></p>
	<input type="button" value="incidents"/>
	<input type="button" value="changes"/>
</div>



<div data-role="page" id="incidentspage"> <!-- Liste des incidents -->
	<header data-role="header">
		<h1>Incidents</h1>
	</header>
	<article data-role="content">
		<ul data-role="listview" data-filter="true" id="incidentslist">
<!--			<li>
				<a href="line1">
					<h1>Abu-Simbel</h1>
					<img src="http://www.google.com/logos/2012/abu-simbel-12-hp.jpg"/>
					<p>abu-simbel</p>
				</a>
			</li> -->
		</ul>
	</article>
	<footer data-role="footer" data-position="fixed">
		<nav data-role="navbar">
			<ul>
				<li><a href="#" data-icon="home">Home</a></li>
				<li><a href="#" data-icon="grid">List</a></li>
				<li><a href="#" data-icon="info">Info</a></li>				
			</ul>
		</nav>
	</footer>
</div>

</body>
</html>